{"version":3,"file":"pixel-renderers.js","sources":["../../src/primitives/pixel-renderers.ts"],"sourcesContent":["/**\n * Pixel grid rendering utilities.\n *\n * All functions produce a flat `Uint8Array` of length `cols * rows` (row-major).\n * Each byte is a palette index: 0 = off, 1 = primary, 2 = success, 3 = warning, 4 = danger.\n * Pixel at (col, row) = `data[row * cols + col]`.\n */\n\n/**\n * Render a right-aligned sparkline chart.\n *\n * Values are normalized to the 0–1 range based on the max value in the array.\n * The most recent value appears at the rightmost column.\n *\n * @param values - Numeric data points\n * @param cols - Grid width\n * @param rows - Grid height\n * @param color - Palette index for lit pixels (default 1)\n */\nexport function sparklineToGrid(\n  values: number[],\n  cols: number,\n  rows: number,\n  color: number = 1,\n): Uint8Array {\n  const grid = new Uint8Array(cols * rows);\n  if (values.length === 0 || rows === 0 || cols === 0) return grid;\n\n  const max = Math.max(...values);\n  const normalized = max > 0 ? values.map((v) => v / max) : values.map(() => 0);\n\n  // Right-align: take the last `cols` values\n  const start = Math.max(0, normalized.length - cols);\n  const visible = normalized.slice(start);\n  const colOffset = cols - visible.length;\n\n  for (let i = 0; i < visible.length; i++) {\n    if (visible[i] === 0) continue;\n    const height = Math.round(visible[i] * (rows - 1));\n    for (let h = 0; h <= height; h++) {\n      const row = rows - 1 - h;\n      grid[row * cols + (colOffset + i)] = color;\n    }\n  }\n\n  return grid;\n}\n\n/**\n * Render a horizontal fill bar.\n *\n * Fills pixels from left to right based on the percentage.\n * The bar is vertically centered and 1 pixel tall.\n *\n * @param percent - Fill percentage (0–100)\n * @param cols - Grid width\n * @param rows - Grid height\n * @param color - Palette index for lit pixels (default 1)\n */\nexport function barToGrid(\n  percent: number,\n  cols: number,\n  rows: number,\n  color: number = 1,\n): Uint8Array {\n  const grid = new Uint8Array(cols * rows);\n  if (rows === 0 || cols === 0) return grid;\n\n  const clamped = Math.max(0, Math.min(100, percent));\n  const fillCols = Math.round((clamped / 100) * cols);\n  const midRow = Math.floor(rows / 2);\n\n  for (let col = 0; col < fillCols; col++) {\n    grid[midRow * cols + col] = color;\n  }\n\n  return grid;\n}\n\n/**\n * Layer multiple grids together. Non-zero values in overlays overwrite the base.\n *\n * All grids must have the same length. If lengths differ, the shorter grid is used\n * up to its length (excess in base is preserved).\n *\n * @param base - The bottom-layer grid\n * @param overlays - Additional grids to layer on top (in order)\n * @returns A new `Uint8Array` with the composited result\n */\nexport function compositeGrids(\n  base: Uint8Array,\n  ...overlays: Uint8Array[]\n): Uint8Array {\n  const result = new Uint8Array(base);\n  for (const overlay of overlays) {\n    const len = Math.min(result.length, overlay.length);\n    for (let i = 0; i < len; i++) {\n      if (overlay[i] !== 0) {\n        result[i] = overlay[i];\n      }\n    }\n  }\n  return result;\n}\n"],"names":["sparklineToGrid","values","cols","rows","color","grid","max","normalized","v","start","visible","colOffset","i","height","h","row","barToGrid","percent","clamped","fillCols","midRow","col","compositeGrids","base","overlays","result","overlay","len"],"mappings":"AAmBO,SAASA,EACdC,GACAC,GACAC,GACAC,IAAgB,GACJ;AACZ,QAAMC,IAAO,IAAI,WAAWH,IAAOC,CAAI;AACvC,MAAIF,EAAO,WAAW,KAAKE,MAAS,KAAKD,MAAS,EAAG,QAAOG;AAE5D,QAAMC,IAAM,KAAK,IAAI,GAAGL,CAAM,GACxBM,IAAaD,IAAM,IAAIL,EAAO,IAAI,CAACO,MAAMA,IAAIF,CAAG,IAAIL,EAAO,IAAI,MAAM,CAAC,GAGtEQ,IAAQ,KAAK,IAAI,GAAGF,EAAW,SAASL,CAAI,GAC5CQ,IAAUH,EAAW,MAAME,CAAK,GAChCE,IAAYT,IAAOQ,EAAQ;AAEjC,WAASE,IAAI,GAAGA,IAAIF,EAAQ,QAAQE,KAAK;AACvC,QAAIF,EAAQE,CAAC,MAAM,EAAG;AACtB,UAAMC,IAAS,KAAK,MAAMH,EAAQE,CAAC,KAAKT,IAAO,EAAE;AACjD,aAASW,IAAI,GAAGA,KAAKD,GAAQC,KAAK;AAChC,YAAMC,IAAMZ,IAAO,IAAIW;AACvB,MAAAT,EAAKU,IAAMb,KAAQS,IAAYC,EAAE,IAAIR;AAAA,IACvC;AAAA,EACF;AAEA,SAAOC;AACT;AAaO,SAASW,EACdC,GACAf,GACAC,GACAC,IAAgB,GACJ;AACZ,QAAMC,IAAO,IAAI,WAAWH,IAAOC,CAAI;AACvC,MAAIA,MAAS,KAAKD,MAAS,EAAG,QAAOG;AAErC,QAAMa,IAAU,KAAK,IAAI,GAAG,KAAK,IAAI,KAAKD,CAAO,CAAC,GAC5CE,IAAW,KAAK,MAAOD,IAAU,MAAOhB,CAAI,GAC5CkB,IAAS,KAAK,MAAMjB,IAAO,CAAC;AAElC,WAASkB,IAAM,GAAGA,IAAMF,GAAUE;AAChC,IAAAhB,EAAKe,IAASlB,IAAOmB,CAAG,IAAIjB;AAG9B,SAAOC;AACT;AAYO,SAASiB,EACdC,MACGC,GACS;AACZ,QAAMC,IAAS,IAAI,WAAWF,CAAI;AAClC,aAAWG,KAAWF,GAAU;AAC9B,UAAMG,IAAM,KAAK,IAAIF,EAAO,QAAQC,EAAQ,MAAM;AAClD,aAASd,IAAI,GAAGA,IAAIe,GAAKf;AACvB,MAAIc,EAAQd,CAAC,MAAM,MACjBa,EAAOb,CAAC,IAAIc,EAAQd,CAAC;AAAA,EAG3B;AACA,SAAOa;AACT;"}