{"version":3,"file":"bh-terminal-input.js","sources":["../../../src/molecules/terminal-input/bh-terminal-input.ts"],"sourcesContent":["import { html, css, nothing } from 'lit';\nimport { customElement, property, state, query } from 'lit/decorators.js';\nimport { BaseElement } from '../../primitives/base-element.js';\n\n/**\n * A terminal input area with a styled prompt, text input, command history,\n * and line-editing shortcuts.\n *\n * @csspart input-area - The outer input container\n * @csspart prompt - The prompt character element\n * @csspart input - The text input element\n *\n * @cssprop [--bh-color-primary] - Accent color for cursor, prompt arrow, and user\n * @cssprop [--bh-color-text] - Text color\n * @cssprop [--bh-color-text-tertiary] - Dim text for prompt decorations\n * @cssprop [--bh-color-bg] - Background color\n * @cssprop [--bh-font-mono] - Monospace font family\n * @cssprop [--bh-color-success] - Path color (falls back to text color)\n *\n * @fires bh-command - When Enter is pressed with non-empty input. Detail is the command string.\n * @fires bh-tab-complete - When Tab is pressed. Detail is the current input value.\n * @fires bh-interrupt - When Ctrl+C is pressed.\n * @fires bh-clear - When Ctrl+L is pressed.\n */\n@customElement('bh-terminal-input')\nexport class BhTerminalInput extends BaseElement {\n  static styles = [\n    ...([BaseElement.styles].flat()),\n    css`\n      :host {\n        display: block;\n      }\n\n      .input-area {\n        background: var(--bh-color-bg, var(--bh-color-cod));\n        padding: 0 16px 12px;\n        flex-shrink: 0;\n      }\n\n      .prompt-line {\n        display: flex;\n        align-items: flex-start;\n        font-family: var(--bh-font-mono);\n        font-size: 13px;\n        line-height: 1.5;\n      }\n\n      .prompt-chrome {\n        color: var(--bh-color-text-tertiary);\n        white-space: pre;\n        user-select: none;\n      }\n\n      .prompt-user {\n        color: var(--bh-color-primary);\n      }\n\n      .prompt-path {\n        color: var(--bh-color-success, var(--bh-color-text));\n      }\n\n      .prompt-char {\n        color: var(--bh-color-primary);\n        white-space: pre;\n        user-select: none;\n        flex-shrink: 0;\n      }\n\n      .cmd-input {\n        flex: 1;\n        font-family: var(--bh-font-mono);\n        font-size: 13px;\n        line-height: 1.5;\n        color: var(--bh-color-text);\n        background: transparent;\n        border: none;\n        outline: none;\n        caret-color: var(--bh-color-primary);\n        padding: 0;\n        margin: 0;\n      }\n\n      .cmd-input:disabled {\n        opacity: 0.5;\n        cursor: not-allowed;\n      }\n\n      @media (max-width: 768px) {\n        .cmd-input {\n          font-size: 16px;\n        }\n      }\n    `,\n  ];\n\n  /** The prompt character(s) displayed before input. */\n  @property() prompt = '\\u25B8 ';\n\n  /** Optional user/host shown in prompt (e.g. 'bh-01'). */\n  @property({ attribute: 'prompt-user' }) promptUser = '';\n\n  /** Optional path shown in prompt. */\n  @property({ attribute: 'prompt-path' }) promptPath = '~';\n\n  /** Disables input when terminal is in RUNNING state. */\n  @property({ type: Boolean, reflect: true }) disabled = false;\n\n  @state() private _history: string[] = [];\n  @state() private _historyIndex = -1;\n  @state() private _tempLine = '';\n\n  @query('.cmd-input') private _input!: HTMLInputElement;\n\n  /** Focus the internal input element. */\n  focus(): void {\n    this.updateComplete.then(() => {\n      this._input?.focus();\n    });\n  }\n\n  private _onKeydown(e: KeyboardEvent): void {\n    const input = this._input;\n\n    if (e.key === 'Enter') {\n      e.preventDefault();\n      const value = input.value.trim();\n      if (value) {\n        this._history = [...this._history, value];\n        this._historyIndex = -1;\n        this._tempLine = '';\n        this.dispatchEvent(\n          new CustomEvent('bh-command', { detail: value, bubbles: true, composed: true })\n        );\n        input.value = '';\n      }\n      return;\n    }\n\n    if (e.key === 'ArrowUp') {\n      e.preventDefault();\n      if (this._history.length === 0) return;\n      if (this._historyIndex === -1) {\n        this._tempLine = input.value;\n        this._historyIndex = this._history.length - 1;\n      } else if (this._historyIndex > 0) {\n        this._historyIndex--;\n      }\n      input.value = this._history[this._historyIndex];\n      return;\n    }\n\n    if (e.key === 'ArrowDown') {\n      e.preventDefault();\n      if (this._historyIndex === -1) return;\n      this._historyIndex++;\n      if (this._historyIndex >= this._history.length) {\n        this._historyIndex = -1;\n        input.value = this._tempLine;\n        this._tempLine = '';\n      } else {\n        input.value = this._history[this._historyIndex];\n      }\n      return;\n    }\n\n    if (e.key === 'Tab') {\n      e.preventDefault();\n      this.dispatchEvent(\n        new CustomEvent('bh-tab-complete', {\n          detail: input.value,\n          bubbles: true,\n          composed: true,\n        })\n      );\n      return;\n    }\n\n    if (e.ctrlKey) {\n      switch (e.key) {\n        case 'c':\n          e.preventDefault();\n          this.dispatchEvent(\n            new CustomEvent('bh-interrupt', { bubbles: true, composed: true })\n          );\n          input.value = '';\n          return;\n        case 'l':\n          e.preventDefault();\n          this.dispatchEvent(\n            new CustomEvent('bh-clear', { bubbles: true, composed: true })\n          );\n          return;\n        case 'u':\n          e.preventDefault();\n          input.value = '';\n          return;\n        case 'k':\n          e.preventDefault();\n          input.value = input.value.substring(0, input.selectionStart ?? 0);\n          return;\n        case 'a':\n          e.preventDefault();\n          input.setSelectionRange(0, 0);\n          return;\n        case 'e':\n          e.preventDefault();\n          input.setSelectionRange(input.value.length, input.value.length);\n          return;\n      }\n    }\n  }\n\n  render() {\n    return html`\n      <div class=\"input-area\" part=\"input-area\">\n        ${this.promptUser\n          ? html`\n              <div class=\"prompt-line\">\n                <span class=\"prompt-chrome\">\\u250C\\u2500[</span>\n                <span class=\"prompt-user\">${this.promptUser}</span>\n                <span class=\"prompt-chrome\">]\\u2500[</span>\n                <span class=\"prompt-path\">${this.promptPath}</span>\n                <span class=\"prompt-chrome\">]</span>\n              </div>\n            `\n          : nothing}\n        <div class=\"prompt-line\">\n          ${this.promptUser\n            ? html`<span class=\"prompt-chrome\">\\u2514\\u2500</span>`\n            : nothing}\n          <span class=\"prompt-char\" part=\"prompt\">${this.prompt}</span>\n          <input\n            type=\"text\"\n            class=\"cmd-input\"\n            part=\"input\"\n            autocomplete=\"off\"\n            autocorrect=\"off\"\n            autocapitalize=\"off\"\n            spellcheck=\"false\"\n            ?disabled=${this.disabled}\n            @keydown=${this._onKeydown}\n          />\n        </div>\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'bh-terminal-input': BhTerminalInput;\n  }\n}\n"],"names":["BhTerminalInput","BaseElement","_a","e","input","value","html","nothing","css","__decorateClass","property","state","query","customElement"],"mappings":"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"}