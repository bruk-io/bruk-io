{"version":3,"file":"bh-pixel-display.js","sources":["../../../src/atoms/pixel-display/bh-pixel-display.ts"],"sourcesContent":["import { html, css, nothing } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { BaseElement } from '../../primitives/base-element.js';\n\nconst PALETTE_CLASSES = ['off', 'primary', 'success', 'warning', 'danger'] as const;\n\n/**\n * An MÃ—N grid of square pixels with on/off glow, used for LED-style displays.\n *\n * The `data` property is a flat row-major `Uint8Array` of length `cols * rows`.\n * Each byte is a palette index: 0 = off, 1 = primary, 2 = success, 3 = warning, 4 = danger.\n *\n * **Important:** Lit only triggers updates on reference change, not mutation.\n * Assign a new `Uint8Array` each time data changes.\n *\n * @csspart grid - The CSS Grid container\n * @csspart pixel - Each individual pixel div\n *\n * @cssprop [--bh-pixel-size=4px] - Pixel width and height\n * @cssprop [--bh-pixel-gap=1px] - Gap between pixels\n * @cssprop [--bh-pixel-off=var(--bh-color-surface-recessed)] - Off-state pixel color\n * @cssprop [--bh-pixel-radius=1px] - Pixel border-radius\n * @cssprop [--bh-pixel-glow=4px] - Glow spread on lit pixels\n */\n@customElement('bh-pixel-display')\nexport class BhPixelDisplay extends BaseElement {\n  static styles = [\n    ...([BaseElement.styles].flat()),\n    css`\n      :host {\n        display: inline-block;\n      }\n\n      .grid {\n        display: grid;\n        grid-template-columns: repeat(var(--_cols), var(--bh-pixel-size, 4px));\n        grid-template-rows: repeat(var(--_rows), var(--bh-pixel-size, 4px));\n        gap: var(--bh-pixel-gap, 1px);\n      }\n\n      .px {\n        width: var(--bh-pixel-size, 4px);\n        height: var(--bh-pixel-size, 4px);\n        border-radius: var(--bh-pixel-radius, 1px);\n        background: var(--bh-pixel-off, var(--bh-color-surface-recessed));\n        transition: background 0.15s, box-shadow 0.15s;\n      }\n\n      .px.primary {\n        background: var(--bh-color-primary);\n        box-shadow: 0 0 var(--bh-pixel-glow, 4px) var(--bh-color-primary-glow);\n      }\n\n      .px.success {\n        background: var(--bh-color-success);\n        box-shadow: 0 0 var(--bh-pixel-glow, 4px) var(--bh-color-success-dim);\n      }\n\n      .px.warning {\n        background: var(--bh-color-warning);\n        box-shadow: 0 0 var(--bh-pixel-glow, 4px) var(--bh-color-warning-dim);\n      }\n\n      .px.danger {\n        background: var(--bh-color-danger);\n        box-shadow: 0 0 var(--bh-pixel-glow, 4px) rgba(239, 68, 68, 0.4);\n      }\n    `,\n  ];\n\n  @property({ type: Number }) cols = 20;\n  @property({ type: Number }) rows = 5;\n  @property({ attribute: false }) data?: Uint8Array;\n  @property() label = '';\n\n  private _prevData?: Uint8Array;\n  private _pixelEls: HTMLDivElement[] = [];\n\n  protected render() {\n    const total = this.cols * this.rows;\n    const hasLabel = this.label.length > 0;\n\n    return html`\n      <div\n        class=\"grid\"\n        part=\"grid\"\n        role=${hasLabel ? 'img' : nothing}\n        aria-label=${hasLabel ? this.label : nothing}\n        aria-hidden=${!hasLabel ? 'true' : nothing}\n        style=\"--_cols:${this.cols};--_rows:${this.rows}\"\n      >\n        ${Array.from({ length: total }, () =>\n          html`<div class=\"px\" part=\"pixel\" aria-hidden=\"true\"></div>`\n        )}\n      </div>\n    `;\n  }\n\n  protected updated() {\n    const data = this.data;\n    const prev = this._prevData;\n\n    // Grab pixel elements after render\n    const grid = this.shadowRoot!.querySelector('.grid');\n    if (!grid) return;\n    this._pixelEls = Array.from(grid.querySelectorAll('.px')) as HTMLDivElement[];\n\n    const total = this.cols * this.rows;\n    for (let i = 0; i < total && i < this._pixelEls.length; i++) {\n      const newVal = data && i < data.length ? data[i] : 0;\n      const oldVal = prev && i < prev.length ? prev[i] : -1;\n\n      if (newVal !== oldVal) {\n        const el = this._pixelEls[i];\n        el.className = `px ${newVal > 0 && newVal < PALETTE_CLASSES.length ? PALETTE_CLASSES[newVal] : ''}`.trimEnd();\n      }\n    }\n\n    // Store a copy for next diff\n    if (data) {\n      this._prevData = new Uint8Array(data);\n    }\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'bh-pixel-display': BhPixelDisplay;\n  }\n}\n"],"names":["PALETTE_CLASSES","BhPixelDisplay","BaseElement","total","hasLabel","html","nothing","data","prev","grid","i","newVal","oldVal","el","css","__decorateClass","property","customElement"],"mappings":";;;;;;;;AAIA,MAAMA,IAAkB,CAAC,OAAO,WAAW,WAAW,WAAW,QAAQ;AAqBlE,IAAMC,IAAN,cAA6BC,EAAY;AAAA,EAAzC,cAAA;AAAA,UAAA,GAAA,SAAA,GA6CuB,KAAA,OAAO,IACP,KAAA,OAAO,GAEvB,KAAA,QAAQ,IAGpB,KAAQ,YAA8B,CAAA;AAAA,EAAC;AAAA,EAE7B,SAAS;AACjB,UAAMC,IAAQ,KAAK,OAAO,KAAK,MACzBC,IAAW,KAAK,MAAM,SAAS;AAErC,WAAOC;AAAA;AAAA;AAAA;AAAA,eAIID,IAAW,QAAQE,CAAO;AAAA,qBACpBF,IAAW,KAAK,QAAQE,CAAO;AAAA,sBAC7BF,IAAoBE,IAAT,MAAgB;AAAA,yBACzB,KAAK,IAAI,YAAY,KAAK,IAAI;AAAA;AAAA,UAE7C,MAAM;AAAA,MAAK,EAAE,QAAQH,EAAA;AAAA,MAAS,MAC9BE;AAAA,IAAA,CACD;AAAA;AAAA;AAAA,EAGP;AAAA,EAEU,UAAU;AAClB,UAAME,IAAO,KAAK,MACZC,IAAO,KAAK,WAGZC,IAAO,KAAK,WAAY,cAAc,OAAO;AACnD,QAAI,CAACA,EAAM;AACX,SAAK,YAAY,MAAM,KAAKA,EAAK,iBAAiB,KAAK,CAAC;AAExD,UAAMN,IAAQ,KAAK,OAAO,KAAK;AAC/B,aAASO,IAAI,GAAGA,IAAIP,KAASO,IAAI,KAAK,UAAU,QAAQA,KAAK;AAC3D,YAAMC,IAASJ,KAAQG,IAAIH,EAAK,SAASA,EAAKG,CAAC,IAAI,GAC7CE,IAASJ,KAAQE,IAAIF,EAAK,SAASA,EAAKE,CAAC,IAAI;AAEnD,UAAIC,MAAWC,GAAQ;AACrB,cAAMC,IAAK,KAAK,UAAUH,CAAC;AAC3B,QAAAG,EAAG,YAAY,MAAMF,IAAS,KAAKA,IAASX,EAAgB,SAASA,EAAgBW,CAAM,IAAI,EAAE,GAAG,QAAA;AAAA,MACtG;AAAA,IACF;AAGA,IAAIJ,MACF,KAAK,YAAY,IAAI,WAAWA,CAAI;AAAA,EAExC;AACF;AAlGaN,EACJ,SAAS;AAAA,EACd,GAAI,CAACC,EAAY,MAAM,EAAE,KAAA;AAAA,EACzBY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAwCF;AAE4BC,EAAA;AAAA,EAA3BC,EAAS,EAAE,MAAM,OAAA,CAAQ;AAAA,GA7Cff,EA6CiB,WAAA,QAAA,CAAA;AACAc,EAAA;AAAA,EAA3BC,EAAS,EAAE,MAAM,OAAA,CAAQ;AAAA,GA9Cff,EA8CiB,WAAA,QAAA,CAAA;AACIc,EAAA;AAAA,EAA/BC,EAAS,EAAE,WAAW,GAAA,CAAO;AAAA,GA/CnBf,EA+CqB,WAAA,QAAA,CAAA;AACpBc,EAAA;AAAA,EAAXC,EAAA;AAAS,GAhDCf,EAgDC,WAAA,SAAA,CAAA;AAhDDA,IAANc,EAAA;AAAA,EADNE,EAAc,kBAAkB;AAAA,GACpBhB,CAAA;"}