{"version":3,"file":"bh-context-menu.js","sources":["../../../src/organisms/overlays/bh-context-menu.ts"],"sourcesContent":["import { html, css, nothing } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { BaseElement } from '../../primitives/base-element.js';\nimport '../../atoms/icon/bh-icon.js';\n\nexport interface ContextMenuItem {\n  id: string;\n  label: string;\n  icon?: string;\n  disabled?: boolean;\n  separator?: boolean;\n}\n\n/**\n * A right-click context menu overlay.\n *\n * @cssprop [--bh-context-menu-min-width=160px] - Minimum menu width\n *\n * @fires bh-select - Fired when a menu item is selected. `detail: { id: string, label: string }`\n */\n@customElement('bh-context-menu')\nexport class BhContextMenu extends BaseElement {\n  static styles = [\n    ...([BaseElement.styles].flat()),\n    css`\n      :host {\n        display: none;\n        position: fixed;\n        inset: 0;\n        z-index: var(--bh-z-popover);\n      }\n\n      :host([open]) {\n        display: block;\n      }\n\n      .backdrop {\n        position: fixed;\n        inset: 0;\n      }\n\n      .menu {\n        position: fixed;\n        min-width: var(--bh-context-menu-min-width, 160px);\n        background: var(--bh-color-surface-raised);\n        border: var(--bh-border-1) solid var(--bh-color-border);\n        border-radius: var(--bh-radius-md);\n        box-shadow: var(--bh-shadow-md);\n        padding: var(--bh-spacing-1) 0;\n        overflow: hidden;\n      }\n\n      .item {\n        display: flex;\n        align-items: center;\n        gap: var(--bh-spacing-2);\n        padding: var(--bh-spacing-1-5) var(--bh-spacing-3);\n        cursor: pointer;\n        font-size: var(--bh-text-sm);\n        color: var(--bh-color-text);\n        transition: background var(--bh-transition-fast);\n      }\n\n      .item:hover,\n      .item[aria-selected='true'] {\n        background: var(--bh-color-surface-overlay);\n      }\n\n      .item.disabled {\n        color: var(--bh-color-text-muted);\n        cursor: default;\n        pointer-events: none;\n      }\n\n      .separator {\n        height: 1px;\n        margin: var(--bh-spacing-1) 0;\n        background: var(--bh-color-border-muted);\n      }\n    `,\n  ];\n\n  @property({ type: Boolean, reflect: true }) open = false;\n  @property({ type: Number }) x = 0;\n  @property({ type: Number }) y = 0;\n  @property({ type: Array }) items: ContextMenuItem[] = [];\n\n  @state() private _selectedIndex = -1;\n\n  private get _actionableItems(): ContextMenuItem[] {\n    return this.items.filter((i) => !i.separator && !i.disabled);\n  }\n\n  show(x: number, y: number, items?: ContextMenuItem[]): void {\n    if (items) this.items = items;\n    this.x = x;\n    this.y = y;\n    this.open = true;\n    this._selectedIndex = -1;\n  }\n\n  hide(): void {\n    this.open = false;\n    this._selectedIndex = -1;\n  }\n\n  private _onBackdropClick() {\n    this.hide();\n  }\n\n  private _onKeydown(e: KeyboardEvent) {\n    const actionable = this._actionableItems;\n    switch (e.key) {\n      case 'Escape':\n        this.hide();\n        break;\n      case 'ArrowDown': {\n        e.preventDefault();\n        const nextIdx = this._selectedIndex + 1;\n        if (nextIdx < actionable.length) {\n          this._selectedIndex = nextIdx;\n        }\n        break;\n      }\n      case 'ArrowUp': {\n        e.preventDefault();\n        const prevIdx = this._selectedIndex - 1;\n        if (prevIdx >= 0) {\n          this._selectedIndex = prevIdx;\n        }\n        break;\n      }\n      case 'Enter': {\n        e.preventDefault();\n        const item = actionable[this._selectedIndex];\n        if (item) this._selectItem(item);\n        break;\n      }\n    }\n  }\n\n  private _selectItem(item: ContextMenuItem) {\n    if (item.disabled) return;\n    this.hide();\n    this.dispatchEvent(\n      new CustomEvent('bh-select', {\n        bubbles: true,\n        composed: true,\n        detail: { id: item.id, label: item.label },\n      })\n    );\n  }\n\n  private _isSelected(item: ContextMenuItem): boolean {\n    const actionable = this._actionableItems;\n    return actionable[this._selectedIndex] === item;\n  }\n\n  protected override render() {\n    if (!this.open) return nothing;\n\n    // Build a stable id for the active item so aria-activedescendant can reference it.\n    const actionable = this._actionableItems;\n    const activeItem = actionable[this._selectedIndex];\n    const activeId = activeItem ? `ctx-item-${this.items.indexOf(activeItem)}` : undefined;\n\n    return html`\n      <div class=\"backdrop\" @click=${this._onBackdropClick}></div>\n      <div\n        class=\"menu\"\n        role=\"menu\"\n        tabindex=\"-1\"\n        aria-activedescendant=${activeId ?? nothing}\n        style=\"left: ${this.x}px; top: ${this.y}px\"\n        @keydown=${this._onKeydown}\n      >\n        ${repeat(\n          this.items,\n          (item) => item.id,\n          (item, i) =>\n            item.separator\n              ? html`<div class=\"separator\" role=\"separator\"></div>`\n              : html`\n                  <div\n                    id=\"ctx-item-${i}\"\n                    class=${classMap({\n                      item: true,\n                      disabled: !!item.disabled,\n                    })}\n                    role=\"menuitem\"\n                    aria-disabled=${item.disabled ? 'true' : 'false'}\n                    aria-selected=${String(this._isSelected(item))}\n                    @click=${() => this._selectItem(item)}\n                  >\n                    ${item.icon ? html`<bh-icon name=${item.icon} size=\"sm\" aria-hidden=\"true\"></bh-icon>` : nothing}\n                    ${item.label}\n                  </div>\n                `\n        )}\n      </div>\n    `;\n  }\n\n  protected override updated() {\n    if (this.open) {\n      const menu = this.shadowRoot?.querySelector('.menu') as HTMLElement;\n      menu?.focus();\n    }\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'bh-context-menu': BhContextMenu;\n  }\n}\n"],"names":["BhContextMenu","BaseElement","i","x","y","items","actionable","nextIdx","prevIdx","item","nothing","activeItem","activeId","html","repeat","classMap","menu","_a","css","__decorateClass","property","state","customElement"],"mappings":"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"}