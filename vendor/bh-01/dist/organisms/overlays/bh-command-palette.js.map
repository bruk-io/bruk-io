{"version":3,"file":"bh-command-palette.js","sources":["../../../src/organisms/overlays/bh-command-palette.ts"],"sourcesContent":["import { html, css, nothing } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { BaseElement } from '../../primitives/base-element.js';\n\nexport interface CommandPaletteItem {\n  id: string;\n  label: string;\n  category?: string;\n  keybinding?: string;\n}\n\n/**\n * A VSCode-style command palette overlay.\n *\n * @cssprop [--bh-command-palette-width=min(500px, 90vw)] - Palette width\n * @cssprop [--bh-command-palette-max-height=300px] - Max height for results list\n * @cssprop [--bh-command-palette-backdrop=var(--bh-color-overlay, rgba(0,0,0,0.4))] - Backdrop color\n *\n * @fires bh-execute - Fired when an item is selected. `detail: { id: string, label: string }`\n * @fires bh-open - Fired when the palette opens\n * @fires bh-close - Fired when the palette closes\n */\n@customElement('bh-command-palette')\nexport class BhCommandPalette extends BaseElement {\n  static styles = [\n    ...([BaseElement.styles].flat()),\n    css`\n      :host {\n        display: none;\n        position: fixed;\n        inset: 0;\n        z-index: var(--bh-z-modal);\n      }\n\n      :host([open]) {\n        display: flex;\n        align-items: flex-start;\n        justify-content: center;\n        padding-top: 15vh;\n      }\n\n      .backdrop {\n        position: fixed;\n        inset: 0;\n        background: var(--bh-command-palette-backdrop, var(--bh-color-overlay));\n      }\n\n      .palette {\n        position: relative;\n        width: var(--bh-command-palette-width, min(500px, 90vw));\n        background: var(--bh-color-surface);\n        border: var(--bh-border-1) solid var(--bh-color-border);\n        border-radius: var(--bh-radius-lg);\n        box-shadow: var(--bh-shadow-xl);\n        overflow: hidden;\n      }\n\n      input {\n        width: 100%;\n        padding: var(--bh-spacing-2) var(--bh-spacing-3);\n        background: var(--bh-color-surface-recessed);\n        border: none;\n        border-bottom: var(--bh-border-1) solid var(--bh-color-border);\n        color: var(--bh-color-text);\n        font-size: var(--bh-text-sm);\n        font-family: inherit;\n        outline: none;\n      }\n\n      input::placeholder {\n        color: var(--bh-color-text-muted);\n      }\n\n      .results {\n        max-height: var(--bh-command-palette-max-height, 300px);\n        overflow-y: auto;\n      }\n\n      .item {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: var(--bh-spacing-2) var(--bh-spacing-3);\n        cursor: pointer;\n        transition: background var(--bh-transition-fast);\n      }\n\n      .item:hover,\n      .item[aria-selected='true'] {\n        background: var(--bh-color-surface-raised);\n      }\n\n      .item-label {\n        font-size: var(--bh-text-sm);\n        color: var(--bh-color-text);\n      }\n\n      .item-category {\n        font-size: var(--bh-text-xs);\n        color: var(--bh-color-text-muted);\n        margin-right: var(--bh-spacing-2);\n      }\n\n      .item-keybinding {\n        font-family: var(--bh-font-mono);\n        font-size: var(--bh-text-xs);\n        color: var(--bh-color-text-muted);\n        background: var(--bh-color-surface-recessed);\n        padding: var(--bh-spacing-0-5) var(--bh-spacing-1-5);\n        border-radius: var(--bh-radius-sm);\n      }\n\n      .empty {\n        padding: var(--bh-spacing-3);\n        font-size: var(--bh-text-sm);\n        color: var(--bh-color-text-muted);\n      }\n    `,\n  ];\n\n  @property({ type: Boolean, reflect: true }) open = false;\n  @property({ type: String }) placeholder = 'Type a command...';\n  @property({ type: Array }) items: CommandPaletteItem[] = [];\n\n  @state() private _query = '';\n  @state() private _selectedIndex = 0;\n\n  private get _filteredItems(): CommandPaletteItem[] {\n    if (!this._query) return this.items;\n    return this.items\n      .map((item) => ({\n        item,\n        score: this._fuzzyScore(item.label, this._query),\n      }))\n      .filter((r) => r.score > 0)\n      .sort((a, b) => b.score - a.score)\n      .map((r) => r.item);\n  }\n\n  private _fuzzyScore(text: string, query: string): number {\n    const lower = text.toLowerCase();\n    const q = query.toLowerCase();\n    let score = 0;\n    let j = 0;\n    let consecutive = 0;\n\n    for (let i = 0; i < lower.length && j < q.length; i++) {\n      if (lower[i] === q[j]) {\n        score += 1 + consecutive;\n        consecutive++;\n        j++;\n      } else {\n        consecutive = 0;\n      }\n    }\n\n    return j === q.length ? score : 0;\n  }\n\n  toggle(): void {\n    if (this.open) {\n      this.close();\n    } else {\n      this.show();\n    }\n  }\n\n  show(): void {\n    this.open = true;\n    this._query = '';\n    this._selectedIndex = 0;\n    this.dispatchEvent(\n      new CustomEvent('bh-open', { bubbles: true, composed: true })\n    );\n    // Query the shadow DOM directly after update to avoid @query caching issues\n    // when render() previously returned nothing.\n    this.updateComplete.then(() => {\n      (this.shadowRoot?.querySelector('input') as HTMLInputElement | null)?.focus();\n    });\n  }\n\n  close(): void {\n    this.open = false;\n    this.dispatchEvent(\n      new CustomEvent('bh-close', { bubbles: true, composed: true })\n    );\n  }\n\n  private _onInput(e: InputEvent) {\n    this._query = (e.target as HTMLInputElement).value;\n    this._selectedIndex = 0;\n  }\n\n  private _onKeydown(e: KeyboardEvent) {\n    const items = this._filteredItems;\n    switch (e.key) {\n      case 'ArrowDown':\n        e.preventDefault();\n        this._selectedIndex = Math.min(\n          this._selectedIndex + 1,\n          items.length - 1\n        );\n        break;\n      case 'ArrowUp':\n        e.preventDefault();\n        this._selectedIndex = Math.max(this._selectedIndex - 1, 0);\n        break;\n      case 'Enter':\n        e.preventDefault();\n        this._executeItem(items[this._selectedIndex]);\n        break;\n      case 'Escape':\n        this.close();\n        break;\n    }\n  }\n\n  private _executeItem(item: CommandPaletteItem | undefined) {\n    if (!item) return;\n    this.close();\n    this.dispatchEvent(\n      new CustomEvent('bh-execute', {\n        bubbles: true,\n        composed: true,\n        detail: { id: item.id, label: item.label },\n      })\n    );\n  }\n\n  private _onItemClick(item: CommandPaletteItem) {\n    this._executeItem(item);\n  }\n\n  protected override render() {\n    if (!this.open) return nothing;\n\n    const items = this._filteredItems;\n    const selectedId = items.length > 0 ? `cp-item-${this._selectedIndex}` : undefined;\n\n    return html`\n      <div class=\"backdrop\" @click=${this.close}></div>\n      <div class=\"palette\" role=\"combobox\" aria-expanded=\"true\" aria-haspopup=\"listbox\">\n        <input\n          type=\"text\"\n          .placeholder=${this.placeholder}\n          .value=${this._query}\n          @input=${this._onInput}\n          @keydown=${this._onKeydown}\n          aria-label=${this.placeholder || 'Search commands'}\n          aria-autocomplete=\"list\"\n          aria-controls=\"cp-results\"\n          aria-activedescendant=${selectedId ?? nothing}\n        />\n        <div class=\"results\" id=\"cp-results\" role=\"listbox\" aria-live=\"polite\">\n          ${items.length === 0\n            ? html`<div class=\"empty\">No matching commands</div>`\n            : repeat(\n                items,\n                (item) => item.id,\n                (item, i) => html`\n                  <div\n                    id=\"cp-item-${i}\"\n                    class=\"item\"\n                    role=\"option\"\n                    aria-selected=${String(i === this._selectedIndex)}\n                    @click=${() => this._onItemClick(item)}\n                  >\n                    <span class=\"item-label\">\n                      ${item.category\n                        ? html`<span class=\"item-category\">${item.category}:</span>`\n                        : nothing}\n                      ${item.label}\n                    </span>\n                    ${item.keybinding\n                      ? html`<span class=\"item-keybinding\">${item.keybinding}</span>`\n                      : nothing}\n                  </div>\n                `\n              )}\n        </div>\n      </div>\n    `;\n  }\n\n  protected override updated() {\n    // Scroll selected item into view after keyboard navigation\n    const selected = this.shadowRoot?.querySelector('.item[aria-selected=\"true\"]');\n    selected?.scrollIntoView({ block: 'nearest' });\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'bh-command-palette': BhCommandPalette;\n  }\n}\n"],"names":["BhCommandPalette","BaseElement","item","r","a","b","text","query","lower","q","score","j","consecutive","i","_b","_a","items","nothing","selectedId","html","repeat","selected","css","__decorateClass","property","state","customElement"],"mappings":"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"}