{"version":3,"file":"bh-data-table.js","sources":["../../../src/organisms/data-table/bh-data-table.ts"],"sourcesContent":["import { html, css, nothing } from 'lit';\nimport { customElement, state } from 'lit/decorators.js';\nimport { BhTable } from '../../molecules/table/bh-table.js';\nimport type { TableColumn, TableVariant, TableDensity } from '../../molecules/table/bh-table.js';\nimport { BhIcon } from '../../atoms/icon/bh-icon.js';\nimport '../../atoms/icon/bh-icon.js';\n\nexport type DataTableVariant = TableVariant;\nexport type DataTableDensity = TableDensity;\nexport type SortDirection = 'asc' | 'desc' | 'none';\n\nexport interface DataTableColumn extends TableColumn {\n  sortable?: boolean;\n}\n\nBhIcon.register('sort-asc', '<path d=\"M12 19V5\"/><path d=\"m5 12 7-7 7 7\"/>');\nBhIcon.register('sort-desc', '<path d=\"M12 5v14\"/><path d=\"m5 12 7 7 7-7\"/>');\n\n/**\n * An interactive data table with sorting support.\n *\n * @csspart table - The `<table>` element\n * @csspart thead - The `<thead>` element\n * @csspart tbody - The `<tbody>` element\n * @csspart th - A header cell\n * @csspart td - A body cell\n * @csspart row - A body `<tr>` row\n * @csspart sort-button - A sortable header button\n *\n * @cssprop [--bh-table-bg=var(--bh-color-surface-raised)] - Table background\n * @cssprop [--bh-table-border=var(--bh-color-border)] - Table border color\n * @cssprop [--bh-table-header-bg=var(--bh-color-surface)] - Header background\n * @cssprop [--bh-table-stripe-bg=var(--bh-color-surface)] - Striped row background\n * @cssprop [--bh-table-hover-bg=var(--bh-color-secondary)] - Row hover background\n * @cssprop [--bh-table-radius=var(--bh-radius-lg)] - Table border radius\n *\n * @fires bh-sort - Fired when a sortable column header is clicked. `detail: { column: string, direction: SortDirection }`\n */\n@customElement('bh-data-table')\nexport class BhDataTable extends BhTable {\n  static override styles = [\n    ...([BhTable.styles].flat()),\n    css`\n      /* Sort button */\n      .sort-button {\n        display: inline-flex;\n        align-items: center;\n        gap: var(--bh-spacing-1);\n        padding: 0;\n        border: none;\n        background: none;\n        color: inherit;\n        font: inherit;\n        font-weight: inherit;\n        cursor: pointer;\n        white-space: nowrap;\n      }\n\n      .sort-button:hover {\n        color: var(--bh-color-text);\n      }\n\n      .sort-button:focus-visible {\n        outline: 2px solid var(--bh-color-ring);\n        outline-offset: 2px;\n        border-radius: var(--bh-radius-sm);\n      }\n\n      /* Sort icons */\n      .sort-icon {\n        display: inline-flex;\n        flex-shrink: 0;\n        opacity: 0.3;\n        transition: opacity var(--bh-transition-fast);\n      }\n\n      .sort-icon.active {\n        opacity: 1;\n      }\n\n      .sort-icon bh-icon {\n        --bh-icon-size: 1em;\n      }\n    `,\n  ];\n\n  declare columns: DataTableColumn[];\n\n  @state() private _sortColumn = '';\n  @state() private _sortDirection: SortDirection = 'none';\n\n  private get _sortedRows(): Record<string, unknown>[] {\n    if (this._sortDirection === 'none' || !this._sortColumn) {\n      return this.rows;\n    }\n\n    const col = this._sortColumn;\n    const dir = this._sortDirection === 'asc' ? 1 : -1;\n\n    return [...this.rows].sort((a, b) => {\n      const aVal = a[col];\n      const bVal = b[col];\n\n      if (aVal == null && bVal == null) return 0;\n      if (aVal == null) return 1;\n      if (bVal == null) return -1;\n\n      if (typeof aVal === 'number' && typeof bVal === 'number') {\n        return (aVal - bVal) * dir;\n      }\n\n      return String(aVal).localeCompare(String(bVal)) * dir;\n    });\n  }\n\n  protected override get _displayRows(): Record<string, unknown>[] {\n    return this._sortedRows;\n  }\n\n  protected override _renderHeaderCell(col: TableColumn) {\n    const dataCol = col as DataTableColumn;\n    if (!dataCol.sortable) {\n      return super._renderHeaderCell(col);\n    }\n\n    const isSorted = this._sortColumn === col.key && this._sortDirection !== 'none';\n\n    return html`\n      <th\n        part=\"th\"\n        class=${col.align ? `align-${col.align}` : ''}\n        style=${col.width ? `width: ${col.width}` : ''}\n        aria-sort=${isSorted\n          ? this._sortDirection === 'asc'\n            ? 'ascending'\n            : 'descending'\n          : nothing}\n      >\n        <button\n          class=\"sort-button\"\n          part=\"sort-button\"\n          @click=${() => this._onSortClick(col.key)}\n        >\n          ${col.label}\n          <span class=\"sort-icon ${isSorted ? 'active' : ''}\">\n            <bh-icon name=${isSorted && this._sortDirection === 'desc' ? 'sort-desc' : 'sort-asc'}></bh-icon>\n          </span>\n        </button>\n      </th>\n    `;\n  }\n\n  private _onSortClick(columnKey: string) {\n    let direction: SortDirection;\n\n    if (this._sortColumn === columnKey) {\n      // Cycle: none -> asc -> desc -> none\n      if (this._sortDirection === 'none') direction = 'asc';\n      else if (this._sortDirection === 'asc') direction = 'desc';\n      else direction = 'none';\n    } else {\n      direction = 'asc';\n    }\n\n    this._sortColumn = columnKey;\n    this._sortDirection = direction;\n\n    this.dispatchEvent(\n      new CustomEvent('bh-sort', {\n        bubbles: true,\n        composed: true,\n        detail: { column: columnKey, direction },\n      })\n    );\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'bh-data-table': BhDataTable;\n  }\n}\n"],"names":["BhIcon","BhDataTable","BhTable","col","dir","a","b","aVal","bVal","isSorted","html","nothing","columnKey","direction","css","__decorateClass","state","customElement"],"mappings":";;;;;;;;;AAeAA,EAAO,SAAS,YAAY,+CAA+C;AAC3EA,EAAO,SAAS,aAAa,+CAA+C;AAuBrE,IAAMC,IAAN,cAA0BC,EAAQ;AAAA,EAAlC,cAAA;AAAA,UAAA,GAAA,SAAA,GAiDI,KAAQ,cAAc,IACtB,KAAQ,iBAAgC;AAAA,EAAA;AAAA,EAEjD,IAAY,cAAyC;AACnD,QAAI,KAAK,mBAAmB,UAAU,CAAC,KAAK;AAC1C,aAAO,KAAK;AAGd,UAAMC,IAAM,KAAK,aACXC,IAAM,KAAK,mBAAmB,QAAQ,IAAI;AAEhD,WAAO,CAAC,GAAG,KAAK,IAAI,EAAE,KAAK,CAACC,GAAGC,MAAM;AACnC,YAAMC,IAAOF,EAAEF,CAAG,GACZK,IAAOF,EAAEH,CAAG;AAElB,aAAII,KAAQ,QAAQC,KAAQ,OAAa,IACrCD,KAAQ,OAAa,IACrBC,KAAQ,OAAa,KAErB,OAAOD,KAAS,YAAY,OAAOC,KAAS,YACtCD,IAAOC,KAAQJ,IAGlB,OAAOG,CAAI,EAAE,cAAc,OAAOC,CAAI,CAAC,IAAIJ;AAAA,IACpD,CAAC;AAAA,EACH;AAAA,EAEA,IAAuB,eAA0C;AAC/D,WAAO,KAAK;AAAA,EACd;AAAA,EAEmB,kBAAkBD,GAAkB;AAErD,QAAI,CADYA,EACH;AACX,aAAO,MAAM,kBAAkBA,CAAG;AAGpC,UAAMM,IAAW,KAAK,gBAAgBN,EAAI,OAAO,KAAK,mBAAmB;AAEzE,WAAOO;AAAA;AAAA;AAAA,gBAGKP,EAAI,QAAQ,SAASA,EAAI,KAAK,KAAK,EAAE;AAAA,gBACrCA,EAAI,QAAQ,UAAUA,EAAI,KAAK,KAAK,EAAE;AAAA,oBAClCM,IACR,KAAK,mBAAmB,QACtB,cACA,eACFE,CAAO;AAAA;AAAA;AAAA;AAAA;AAAA,mBAKA,MAAM,KAAK,aAAaR,EAAI,GAAG,CAAC;AAAA;AAAA,YAEvCA,EAAI,KAAK;AAAA,mCACcM,IAAW,WAAW,EAAE;AAAA,4BAC/BA,KAAY,KAAK,mBAAmB,SAAS,cAAc,UAAU;AAAA;AAAA;AAAA;AAAA;AAAA,EAK/F;AAAA,EAEQ,aAAaG,GAAmB;AACtC,QAAIC;AAEJ,IAAI,KAAK,gBAAgBD,IAEnB,KAAK,mBAAmB,SAAQC,IAAY,QACvC,KAAK,mBAAmB,QAAOA,IAAY,SAC/CA,IAAY,SAEjBA,IAAY,OAGd,KAAK,cAAcD,GACnB,KAAK,iBAAiBC,GAEtB,KAAK;AAAA,MACH,IAAI,YAAY,WAAW;AAAA,QACzB,SAAS;AAAA,QACT,UAAU;AAAA,QACV,QAAQ,EAAE,QAAQD,GAAW,WAAAC,EAAA;AAAA,MAAU,CACxC;AAAA,IAAA;AAAA,EAEL;AACF;AAxIaZ,EACK,SAAS;AAAA,EACvB,GAAI,CAACC,EAAQ,MAAM,EAAE,KAAA;AAAA,EACrBY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA0CF;AAIiBC,EAAA;AAAA,EAAhBC,EAAA;AAAM,GAjDIf,EAiDM,WAAA,eAAA,CAAA;AACAc,EAAA;AAAA,EAAhBC,EAAA;AAAM,GAlDIf,EAkDM,WAAA,kBAAA,CAAA;AAlDNA,IAANc,EAAA;AAAA,EADNE,EAAc,eAAe;AAAA,GACjBhB,CAAA;"}